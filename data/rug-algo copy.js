function setup(){noiseSeed(s),window.d=function($){window.prngSeed=$%2147483647,window.prngSeed<=0&&(window.prngSeed+=2147483646)},window.b=function(){return window.prngSeed=16807*window.prngSeed%2147483647,(window.prngSeed-1)/2147483646},window.a=function($,t){return $+window.b()*(t-$)},window.c=function($){return $[Math.floor(window.b()*$.length)]},window.d(s);createCanvas(h+4*f,w+4*f).parent("rug"),pixelDensity(2.5),u(),gtd(),noLoop()}function u(){if(!p||!p.colors)return;let $=p.colors[0],t=p.colors[0],e=999,l=-1;for(const o of p.colors){const r=color(o),_=(red(r)+green(r)+blue(r))/3;_<e&&(e=_,$=o),_>l&&(l=_,t=o)}dt=lerpColor(color($),color(0),.4),lt=lerpColor(color(t),color(255),.3)}function draw(){for(const $ of(background(222,222,222),push(),translate(width/2,height/2),rotate(PI/2),translate(-height/2,-width/2),push(),translate(2*f,2*f),sd))ds($);tl>0&&dtol(Math.floor(tl)),pop(),df(),dl>0&&ddo(Math.floor(dl)),pop()}function ds($){const t=wp+1,e=wt+1;for(let l=0;l<w;l+=t)for(let o=$.y;o<$.y+$.h;o+=e){let r=color($.pc),_=!1;if(td.length>0){for(const n of td)if(l>=n.x&&l<n.x+n.width&&o>=n.y&&o<n.y+n.height){_=!0;break}}let i=red(r)+window.a(-15,15),a=green(r)+window.a(-15,15),c=blue(r)+window.a(-15,15);if(_){const d=(i+a+c)/3,g=d<128?lt:dt;i=red(g),a=green(g),c=blue(g)}i=constrain(i,0,255),a=constrain(a,0,255),c=constrain(c,0,255),fill(i,a,c),noStroke();rect(l+.5*sin(.05*o),o,wp,e)}for(let y=$.y;y<$.y+$.h;y+=e)for(let b=0;b<w;b+=t){let m=color($.pc),S=!1;if(td.length>0){for(const x of td)if(b>=x.x&&b<x.x+x.width&&y>=x.y&&y<x.y+x.height){S=!0;break}}if("m"===$.wt&&$.sc)noise(.1*b,.1*y)>.5&&(m=color($.sc));else if("t"===$.wt){const k=noise(.05*b,.05*y);m=lerpColor(color($.pc),color(255),.15*k)}let A=red(m)+window.a(-20,20),C=green(m)+window.a(-20,20),U=blue(m)+window.a(-20,20);if(S){fill(0,0,0);noStroke();const v=.5*cos(.05*b);rect(b+1,y+v+1,t,wt),rect(b-1,y+v-1,t,wt),rect(b+1,y+v-1,t,wt),rect(b-1,y+v+1,t,wt),rect(b+2,y+v,t,wt),rect(b-2,y+v,t,wt),rect(b,y+v+2,t,wt),rect(b,y+v-2,t,wt),rect(b+2,y+v+2,t,wt),rect(b-2,y+v-2,t,wt),rect(b+2,y+v-2,t,wt),rect(b-2,y+v+2,t,wt);const j=(A+C+U)/3,q=j<128?lt:dt;A=red(q),C=green(q),U=blue(q)}A=constrain(A,0,255),C=constrain(C,0,255),U=constrain(U,0,255),fill(A,C,U),noStroke();const v=.5*cos(.05*b);rect(b,y+v,t,wt)}for(let z=$.y;z<$.y+$.h;z+=2*e)for(let B=0;B<w;B+=2*t)fill(0,0,0,40),noStroke(),rect(B+1,z+1,t-2,e-2);for(let D=$.y+e;D<$.y+$.h;D+=2*e)for(let E=t;E<w;E+=2*t)fill(255,255,255,30),noStroke(),rect(E,D,t-1,e-1)}function dto(){push(),blendMode(MULTIPLY);for(let $=0;$<w;$+=2)for(let t=0;t<h;t+=2){let e;fill(0,0,0,map(noise(.02*$,.02*t),0,1,0,50)),noStroke(),rect($,t,2,2)}for(let l=0;l<w;l+=6)for(let o=0;o<h;o+=6){const r=noise(.03*l,.03*o);r>.6?(fill(255,255,255,25),noStroke(),rect(l,o,6,6)):r<.4&&(fill(0,0,0,20),noStroke(),rect(l,o,6,6))}pop()}function dtol($){const t=10+19*$ ,e=5+10*$ ,l=.7-.05*$ ;push(),blendMode(MULTIPLY);for(let o=0;o<w;o+=2)for(let r=0;r<h;r+=2){let _;fill(0,0,0,map(noise(.02*o,.02*r),0,1,0,t)),noStroke(),rect(o,r,2,2)}for(let n=0;n<w;n+=6)for(let i=0;i<h;i+=6){const a=noise(.03*n,.03*i);a>l?(fill(255,255,255,e),noStroke(),rect(n,i,6,6)):a<1-l&&(fill(0,0,0,.8*e),noStroke(),rect(n,i,6,6))}if($>=4)for(let c=0;c<w;c+=8)for(let d=0;d<h;d+=8)noise(.01*c,.01*d)>.7&&(fill(0,0,0,15),noStroke(),rect(c,d,8,2));if($>=7)for(let g=0;g<w;g+=4)for(let y=0;y<h;y+=4)noise(.005*g,.005*y)>.8&&(fill(0,0,0,25),noStroke(),rect(g,y,4,1));if($>=9)for(let y=0;y<w;y+=12)for(let b=0;b<h;b+=12)noise(.002*y,.002*b)>.75&&(fill(0,0,0,35),noStroke(),rect(y,b,12,1));pop()}function ddo($){const t=1===$?.5:1,e=1===$?30:60;push(),translate(2*f,2*f);for(let l=0;l<w;l+=3)for(let o=0;o<h;o+=3){const r=window.a(0,1),_=.85*t;if(r>_){const n=window.a(1,4),i=window.a(.5*e,e),a=window.a(60,90),c=window.a(40,60),d=window.a(20,40);fill(a,c,d,i),noStroke(),ellipse(l,o,n,n)}}for(let g=0;g<15*t;g++){const y=window.a(0,w),b=window.a(0,h),m=window.a(8,20),S=window.a(.3*e,.7*e),x=window.a(40,70),k=window.a(25,45),A=window.a(15,30);fill(x,k,A,S),noStroke(),ellipse(y,b,m,m)}for(let C=0;C<w;C+=2)for(let U=0;U<h;U+=2){const j=Math.min(C,U,w-C,h-U);if(j<10){const q=window.a(0,1);if(q>.7*t){const v=window.a(10,25);fill(80,50,20,v),noStroke(),rect(C,U,2,2)}}}pop()}function df(){dfs(2*f,f,w,f,"top"),dfs(2*f,2*f+h,w,f,"bottom"),dse()}function dfs($,t,e,l,o){const r=e/12,_=e/r;for(let n=0;n<r;n++){const i=$+n*_;if(!p||!p.colors)return;const a=window.c(p.colors);for(let c=0;c<12;c++){const d=i+window.a(-_/6,_/6),g="top"===o?t+l:t,y="top"===o?t:t+l,b=window.a(1,4),m=window.a(.2,.8),S=window.c([-1,1]),x=window.a(.5,2),k=window.a(.8,1.2),A=color(a),C=.7*red(A),U=.7*green(A),j=.7*blue(A);stroke(C,U,j),strokeWeight(window.a(.5,1.2)),noFill(),beginShape();for(let q=0;q<=1;q+=.1){let v=lerp(g,y,q*k),z=sin(q*PI*m)*b*q*S*x;z+=window.a(-1,1),.3>window.b()&&(z+=window.a(-2,2)),vertex(d+z,v)}endShape()}}}function dse(){const $=wt+1;function t(t){const e="left"===t?0:w,l="left"===t?0:PI;for(const o of sd)for(let r=o.y;r<o.y+o.h;r+=$){if(r===o.y||o===sd[sd.length-1]&&r+$>=o.y+o.h)continue;let _=color(o.pc);if(o.sc&&"m"===o.wt){const n=color(o.sc);_=lerpColor(_,n,.5*noise(.1*r)+.5)}const i=.8*red(_),a=.8*green(_),c=.8*blue(_);fill(i,a,c),noStroke();let d=wt*window.a(1.2,1.8),g=2*f+e+window.a(-2,2),y=2*f+r+wt/2+window.a(-1,1),b;dtsa(g,y,d,l+HALF_PI+window.a(-.2,.2),l-HALF_PI+window.a(-.2,.2),i,a,c,t)}}t("left"),t("right")}function dtsa($,t,e,l,o,r,_,n,i){const a=max(6,floor(e/1.2)),c=e/a;for(let d=0;d<a;d++){let g=e-d*c,y,b,m;d%2==0?(y=constrain(r+25,0,255),b=constrain(_+25,0,255),m=constrain(n+25,0,255)):(y=constrain(r-20,0,255),b=constrain(_-20,0,255),m=constrain(n-20,0,255)),fill(y,b,m,88),arc($,t,2*g,2*g,l,o)}fill(.6*r,.6*_,.6*n,70),arc($+("left"===i?1:-1),t+1,2*e,2*e,l,o);for(let S=0;S<5;S++){const x=window.a(l,o),k=e*window.a(.2,.7),A=$+cos(x)*k,C=t+sin(x)*k;fill(r,_,n,120),ellipse(A,C,window.a(1.5,3.5),window.a(1.5,3.5))}}function gtd(){td=[];const $=tr||[];if(!$||0===$.length)return;const t=$.filter($=>$&&""!==$.trim());if(0===t.length)return;let e=wp+1,l=wt+1,o=e*ts,r=l*ts,_=7*o,n=5*r,i=r,a=1.5*_,c=t.length*_+(t.length-1)*a,d=(w-c)/2,g=0;for(let y=0;y<$.length;y++){const b=$[y];if(!b||""===b.trim())continue;const m=_,S=b.length*(n+i)-i,x=d+g*(_+a),k=(h-S)/2;for(let A=0;A<b.length;A++){const C=b.charAt(A),U=k+(b.length-1-A)*(n+i),j=gcp(C,x,U,m,n);td.push(...j)}g++}}function gcp($,t,e,l,o){const r=[],_=wp+1,n=wt+1,i=_*ts,a=n*ts,c=cm[$.toUpperCase()]||cm[" "],d=c.length,g=c[0].length;for(let y=0;y<d;y++)for(let b=0;b<g;b++)if("1"===c[y][b]){const m=y,S=g-1-b;r.push({x:t+m*i,y:e+S*a,width:i,height:a})}return r}