<!DOCTYPE html>
<html>
<head>
    <title>Test TokenURI Decoder</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        textarea { width: 100%; height: 200px; margin: 10px 0; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        iframe { width: 100%; height: 400px; border: 1px solid #ccc; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>TokenURI Decoder for Shape L2 Onchain Rug</h1>
    <p>Contract: <strong>0x7e14011EEA66848C208cddDd9bE76EA80D3522Fb</strong></p>
    <p>Token ID: <strong>1</strong></p>

    <h3>Step 1: Paste the tokenURI (data:application/json;base64,...)</h3>
    <textarea id="tokenUriInput" placeholder="Paste the complete tokenURI here..."></textarea>

    <h3>Step 2: Extract and Decode</h3>
    <button onclick="extractHTML()">Extract HTML</button>
    <button onclick="decodeAndShow()">Decode & Show</button>

    <h3>Step 3: Result</h3>
    <div id="result"></div>

    <h3>Step 4: Preview</h3>
    <iframe id="previewFrame" src="about:blank"></iframe>

    <script>
        function extractHTML() {
            const tokenUri = document.getElementById('tokenUriInput').value;

            if (!tokenUri.includes('data:application/json;base64,')) {
                alert('Invalid tokenURI format. Must contain "data:application/json;base64,"');
                return;
            }

            // Extract base64 part
            const base64Part = tokenUri.split('data:application/json;base64,')[1];

            // Decode JSON
            try {
                const jsonStr = atob(base64Part);
                const metadata = JSON.parse(jsonStr);

                // Extract HTML base64 from image field
                if (metadata.image && metadata.image.includes('data:text/html;base64,')) {
                    const htmlBase64 = metadata.image.split('data:text/html;base64,')[1];

                    document.getElementById('result').innerHTML = `
                        <h4>Decoded JSON Metadata:</h4>
                        <pre>${JSON.stringify(metadata, null, 2)}</pre>
                        <h4>HTML Base64:</h4>
                        <textarea readonly style="width:100%;height:100px;">${htmlBase64}</textarea>
                    `;
                } else {
                    document.getElementById('result').innerHTML = '<p>No HTML found in metadata</p>';
                }
            } catch (e) {
                document.getElementById('result').innerHTML = `<p>Error decoding: ${e.message}</p>`;
            }
        }

        function decodeAndShow() {
            const tokenUri = document.getElementById('tokenUriInput').value;

            if (!tokenUri.includes('data:application/json;base64,')) {
                alert('Invalid tokenURI format');
                return;
            }

            // Extract base64 part
            const base64Part = tokenUri.split('data:application/json;base64,')[1];

            try {
                const jsonStr = atob(base64Part);
                const metadata = JSON.parse(jsonStr);

                // Extract HTML base64 from image field
                if (metadata.image && metadata.image.includes('data:text/html;base64,')) {
                    const htmlBase64 = metadata.image.split('data:text/html;base64,')[1];
                    const htmlContent = atob(htmlBase64);

                    // Create data URL for iframe
                    const dataUrl = `data:text/html;base64,${btoa(htmlContent)}`;
                    document.getElementById('previewFrame').src = dataUrl;

                    document.getElementById('result').innerHTML = `
                        <h4>Decoded HTML Content:</h4>
                        <textarea readonly style="width:100%;height:200px;">${htmlContent}</textarea>
                        <h4>Preview loaded in iframe below</h4>
                    `;
                } else {
                    document.getElementById('result').innerHTML = '<p>No HTML found in metadata</p>';
                }
            } catch (e) {
                document.getElementById('result').innerHTML = `<p>Error: ${e.message}</p>`;
            }
        }
    </script>
</body>
</html>
