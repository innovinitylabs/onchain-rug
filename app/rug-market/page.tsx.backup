'use client'

import { useState, useEffect, useMemo } from 'react'
import { useRouter } from 'next/navigation'
import { motion } from 'framer-motion'
import Navigation from '../../components/Navigation'
import Footer from '../../components/Footer'
import LoadingAnimation from '../../components/LoadingAnimation'
import RugMarketGrid from '../../components/RugMarketGrid'
import { ShoppingCart, Sparkles, TrendingUp } from 'lucide-react'
import { RugMarketNFT } from '../../lib/rug-market-types'

type ListingFilter = 'all' | 'listed' | 'unlisted'
type SortOption = 'tokenId' | 'price-low' | 'price-high' | 'rarity' | 'newest'

export default function RugMarketPage() {
  const router = useRouter()
  const [isLoading, setIsLoading] = useState(true)
  const [allNFTs, setAllNFTs] = useState<RugMarketNFT[]>([])
  const [searchQuery, setSearchQuery] = useState('')
  const [listingFilter, setListingFilter] = useState<ListingFilter>('all')
  const [sortBy, setSortBy] = useState<SortOption>('tokenId')
  const [stats, setStats] = useState({
    totalNFTs: 0,
    floorPrice: '0',
    volume24h: '0',
    sales24h: 0
  })
  const [statsLoading, setStatsLoading] = useState(true)

  // Fetch NFT data and stats on mount
  useEffect(() => {
    console.log('Using hardcoded test data for marketplace')

    const testNFTs = [
      {
        tokenId: 1,
        permanent: {
          tokenId: 1,
          seed: '12345',
          paletteName: 'Cornell Red',
          minifiedPalette: '{"name":"Cornell Red","colors":["#B31B1B","#8B0000","#DC143C","#FF0000"]}',
          minifiedStripeData: '[{"y":0,"h":70,"pc":"#B31B1B","wt":"s","wv":0.3},{"y":70,"h":65,"pc":"#8B0000","wt":"t","wv":0.4}]',
          textRows: ['TEST RUG'],
          warpThickness: 2,
          mintTime: Date.now().toString(),
          filteredCharacterMap: '{"T":["11111"],"E":["11111"],"S":["01111"],"R":["11111"],"U":["10001"],"G":["01111"]," ":["00000"]}',
          curator: '0x742d35Cc6E1a3c5B4F5E5C7A1B2C3D4E5F6A7B8C9D0E1F2A',
          characterCount: '10',
          stripeCount: '18',
          name: 'OnchainRug #1',
          description: 'Test NFT from .env contract',
          image: '/logo.png'
        },
        dynamic: {
          dirtLevel: 0,
          agingLevel: 0,
          frameLevel: 'good',
          maintenanceScore: '100',
          currentOwner: '0x742d35Cc6E1a3c5B4F5E5C7A1B2C3D4E5F6A7B8C9D0E1F2A',
          listingPrice: '0',
          isListed: false,
          lastSalePrice: '0',
          cleaningCount: 0,
          restorationCount: 0,
          masterRestorationCount: 0,
          launderingCount: 0,
          lastCleaned: '0',
          saleHistory: [],
          lastUpdated: Date.now().toString()
        }
      }
    ]

    console.log('Setting test NFTs:', testNFTs.length)
    setAllNFTs(testNFTs)
    setStats({
      totalNFTs: 1,
      floorPrice: '0.01',
      volume24h: '0.05',
      sales24h: 1
    })

    setIsLoading(false)
    setStatsLoading(false)
  }, [])

  // Filter and sort NFTs based on current filters
