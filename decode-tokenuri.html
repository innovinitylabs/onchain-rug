<!DOCTYPE html>
<html>
<head>
    <title>TokenURI Decoder</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .step { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        .result { background: #f0f0f0; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>How to Decode tokenURI</h1>
    
    <div class="step">
        <h3>1. Get the tokenURI (base64 encoded JSON)</h3>
        <p>This is what you get when you call contract.tokenURI(tokenId)</p>
    </div>
    
    <div class="step">
        <h3>2. Decode the base64 to get JSON metadata</h3>
        <pre class="result">{
  "name": "Onchain Rug #1",
  "description": "A fully on-chain generative rug NFT with aging mechanics",
  "image": "data:text/html;base64,[BASE64_ENCODED_HTML]",
  "attributes": [
    {"trait_type": "Text Lines", "value": "3"},
    {"trait_type": "Warp Thickness", "value": "2"},
    {"trait_type": "Dirt Level", "value": "0"},
    {"trait_type": "Texture Level", "value": "0"}
  ]
}</pre>
    </div>
    
    <div class="step">
        <h3>3. Extract the HTML from the 'image' field</h3>
        <p>The 'image' field contains: <code>data:text/html;base64,[BASE64_ENCODED_HTML]</code></p>
        <p>You need to:</p>
        <ul>
            <li>Split on 'data:text/html;base64,'</li>
            <li>Take the second part (the base64 HTML)</li>
            <li>Decode that base64 to get the actual HTML</li>
        </ul>
    </div>
    
    <div class="step">
        <h3>4. Result: Actual HTML content</h3>
        <pre class="result">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;Rug #1&lt;/title&gt;
  &lt;style&gt;
    body { margin: 0; background: #f0f0f0; }
    canvas { display: block; border: 2px solid #ccc; }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id="canvas-container"&gt;&lt;/div&gt;
  &lt;script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"&gt;&lt;/script&gt;
  &lt;script&gt;
    // P5.js code to render the rug
    // This generates the actual visual rug
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
    </div>
    
    <div class="step">
        <h3>5. JavaScript Code to Decode:</h3>
        <pre class="result">async function decodeTokenURI(tokenId) {
    // Get the base64 encoded tokenURI
    const tokenURI = await contract.tokenURI(tokenId);
    
    // Step 1: Decode base64 to JSON
    const jsonString = atob(tokenURI.split('data:application/json;base64,')[1]);
    const metadata = JSON.parse(jsonString);
    
    // Step 2: Extract HTML from image field
    const imageUrl = metadata.image;
    const base64Html = imageUrl.split('data:text/html;base64,')[1];
    
    // Step 3: Decode HTML
    const html = atob(base64Html);
    
    return html;
}</pre>
    </div>
    
    <h2>Why You See "Gibberish":</h2>
    <p>You see gibberish because you're decoding the <strong>outer base64 layer</strong> which gives you <strong>JSON metadata</strong>, not the inner HTML.</p>
    
    <p>The structure is:</p>
    <ul>
        <li><strong>Layer 1:</strong> JSON metadata → base64 (tokenURI)</li>
        <li><strong>Layer 2:</strong> HTML → base64 (inside JSON's image field)</li>
    </ul>
    
    <p>You need to decode <strong>twice</strong> to get the actual HTML!</p>
</body>
</html>
