<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Test Minimal P5.js with Ultra-Minimal Algorithm</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #f0f0f0;
            font-family: monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            flex-direction: column;
        }
        .test-container {
            text-align: center;
            margin-bottom: 20px;
        }
        .test-info {
            margin-bottom: 20px;
            color: #333;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-seed {
            font-weight: bold;
            color: #0066cc;
        }
        #canvas-container {
            border: 2px solid #333;
            border-radius: 8px;
            background: white;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-info">
            <h2>Minimal P5.js + Ultra-Minimal Algorithm Test</h2>
            <p><strong>Seed:</strong> <span class="test-seed">9667</span></p>
            <p><strong>Text:</strong> OINON</p>
            <p><strong>Palette:</strong> Indian Peacock</p>
            <p><strong>Warp Thickness:</strong> 3</p>
            <p><strong>Dirt Level:</strong> 0 (Clean)</p>
            <p><strong>Texture Level:</strong> 0 (Smooth)</p>
        </div>
        <div id="canvas-container"></div>
    </div>

    <!-- Use our minimal P5.js library -->
    <script src="data/p5-minimal.js"></script>
    
    <script>
        // Test parameters extracted from doormat-nft-9667.html
        const testSeed = 9667;
        const testPalette = {
            "name": "Indian Peacock",
            "colors": ["#000080", "#191970", "#4169E1", "#4682B4", "#00CED1", "#40E0D0", "#48D1CC", "#20B2AA"]
        };
        const testStripeData = [
            {"y": 0, "height": 79.21721367165446, "primaryColor": "#48D1CC", "secondaryColor": "#48D1CC", "weaveType": "solid", "warpVariation": 0.38434289479628203},
            {"y": 79.21721367165446, "height": 85.13879705220461, "primaryColor": "#4682B4", "secondaryColor": null, "weaveType": "solid", "warpVariation": 0.33504934683442117},
            {"y": 164.35601072385907, "height": 50.84667540155351, "primaryColor": "#000080", "secondaryColor": null, "weaveType": "textured", "warpVariation": 0.2733596692793071},
            {"y": 215.20268612541258, "height": 89.79343278333545, "primaryColor": "#4169E1", "secondaryColor": "#20B2AA", "weaveType": "solid", "warpVariation": 0.14692649776116015},
            {"y": 304.99611890874803, "height": 52.31130842119455, "primaryColor": "#000080", "secondaryColor": null, "weaveType": "mixed", "warpVariation": 0.4196585290133953},
            {"y": 357.3074273299426, "height": 60.743321096524596, "primaryColor": "#4682B4", "secondaryColor": "#4169E1", "weaveType": "textured", "warpVariation": 0.4864370165392756},
            {"y": 418.0507484264672, "height": 66.93822269327939, "primaryColor": "#00CED1", "secondaryColor": null, "weaveType": "textured", "warpVariation": 0.4537904390133918},
            {"y": 484.98897111974657, "height": 82.49259550124407, "primaryColor": "#40E0D0", "secondaryColor": null, "weaveType": "solid", "warpVariation": 0.3178469844162464},
            {"y": 567.4815666209906, "height": 74.61626417003572, "primaryColor": "#20B2AA", "secondaryColor": null, "weaveType": "solid", "warpVariation": 0.13441032571718098},
            {"y": 642.0978307910264, "height": 64.18415797874331, "primaryColor": "#4682B4", "secondaryColor": "#40E0D0", "weaveType": "textured", "warpVariation": 0.29444277519360185},
            {"y": 706.2819887697697, "height": 65.48063192516565, "primaryColor": "#40E0D0", "secondaryColor": null, "weaveType": "textured", "warpVariation": 0.36636398062109954},
            {"y": 771.7626206949353, "height": 89.92705247364938, "primaryColor": "#40E0D0", "secondaryColor": null, "weaveType": "solid", "warpVariation": 0.21276599718257785},
            {"y": 861.6896731685847, "height": 81.5887519530952, "primaryColor": "#20B2AA", "secondaryColor": null, "weaveType": "mixed", "warpVariation": 0.1591447101905942},
            {"y": 943.2784251216799, "height": 84.31571879424155, "primaryColor": "#00CED1", "secondaryColor": null, "weaveType": "solid", "warpVariation": 0.13071596445515754},
            {"y": 1027.5941439159214, "height": 88.51619102060795, "primaryColor": "#4169E1", "secondaryColor": null, "weaveType": "solid", "warpVariation": 0.2974648263305426},
            {"y": 1116.1103349365294, "height": 53.44750354997814, "primaryColor": "#40E0D0", "secondaryColor": null, "weaveType": "textured", "warpVariation": 0.20352187594398857},
            {"y": 1169.5578384865075, "height": 30.442161513492465, "primaryColor": "#20B2AA", "secondaryColor": null, "weaveType": "textured", "warpVariation": 0.10008611883968116}
        ];
        const testTextRows = ["OINON"];
        const testCharacterMap = {
            "O": ["01110", "10001", "10001", "10001", "10001", "10001", "01110"],
            "I": ["11111", "00100", "00100", "00100", "00100", "00100", "11111"],
            "N": ["10001", "11001", "10101", "10011", "10001", "10001", "10001"],
            " ": ["00000", "00000", "00000", "00000", "00000", "00000", "00000"]
        };
        const testShowDirt = false;
        const testDirtLevel = 0;
        const testShowTexture = false;
        const testTextureLevel = 0;
        const testWarpThickness = 3;

        // Test the ultra-minimal algorithm function
        function testUltraMinimalAlgorithm() {
            console.log("Testing ultra-minimal algorithm with minimal P5.js...");
            
            // Call the ultra-minimal algorithm function
            const html = generateRugHTML(
                testSeed,
                testPalette,
                testStripeData,
                testTextRows,
                testCharacterMap,
                testShowDirt,
                testDirtLevel,
                testShowTexture,
                testTextureLevel,
                testWarpThickness
            );
            
            console.log("Generated HTML length:", html.length);
            console.log("Algorithm test completed successfully!");
            
            return html;
        }

        // Load and test the ultra-minimal algorithm
        function loadAndTestAlgorithm() {
            // Load the ultra-minimal algorithm
            const script = document.createElement('script');
            script.src = 'data/rug-algorithm-ultra-minimal.js';
            script.onload = function() {
                console.log("Ultra-minimal algorithm loaded successfully!");
                
                // Test the algorithm
                try {
                    const result = testUltraMinimalAlgorithm();
                    console.log("✅ Test passed! Algorithm works with minimal P5.js");
                    
                    // Update the page to show success
                    document.querySelector('.test-info').innerHTML += 
                        '<p style="color: green; font-weight: bold;">✅ Test PASSED - Algorithm works with minimal P5.js!</p>';
                        
                } catch (error) {
                    console.error("❌ Test failed:", error);
                    document.querySelector('.test-info').innerHTML += 
                        '<p style="color: red; font-weight: bold;">❌ Test FAILED: ' + error.message + '</p>';
                }
            };
            script.onerror = function() {
                console.error("Failed to load ultra-minimal algorithm");
                document.querySelector('.test-info').innerHTML += 
                    '<p style="color: red; font-weight: bold;">❌ Failed to load algorithm file</p>';
            };
            document.head.appendChild(script);
        }

        // Start the test when page loads
        window.addEventListener('load', function() {
            console.log("Page loaded, starting test...");
            loadAndTestAlgorithm();
        });
    </script>
</body>
</html>
